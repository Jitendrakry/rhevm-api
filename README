= RHEV-M API Definition =

This project's goal is to define an official RESTful API for RHEV-M.

See our wiki for more details:

  https://fedorahosted.org/rhevm-api/


== Disclaimers ==

The API definition is in its early stages. It may yet change radically
and/or never become the official API.

The PowerShell wrapper is for experimentation only and not a supported
Red Hat solution.


== Deploying ==

The rhevm-api-powershell.war is designed to be deployed to a Java EE
servlet container (such as JBoss EAP/AS or Apache Tomcat) running on
your a machine alongside a RHEV-M 2.2 installation.

Below are instructions for deploying to JBoss and Tomcat. In both cases,
once the application server is running, you should be able to connect to
the API via the following URL:

  http://$host:$port/rhevm-api-powershell/

JBoss:
------

You first need to install JBoss. JBoss EAP 5.0 or JBoss AS 5.1.0.GA
should work.

Steps:

  1) Download:

      https://sourceforge.net/projects/jboss/files/JBoss/JBoss-5.1.0.GA/jboss-5.1.0.GA.zip/download

  2) Unzip into suitable directory

  3) Copy rhevm-api-powershell.war under

       jboss-5.1.0.GA\server\default\deploy

  4) RHEV-M is probably already using port 8080, so change the port
     number in:

       jboss-5.1.0.GA\server\default\conf\bindingservice.beans\META-INF\bindings-jboss-beans.xml

  5) Run JBoss:

       jboss-5.1.0.GA\bin\run.bat

     (If you want to connect remotely, pass '-b 0.0.0.0' to run.bat)

Tomcat:
-------

To run rhevm-api under Apache Tomcat 5.5.x, follow these steps:

  1) Download:

      http://apache.mirrors.esat.net/tomcat/tomcat-5/v5.5.29/bin/apache-tomcat-5.5.29.zip

  2) Unzip into suitable directory

  3) Copy rhevm-api-powershell.war under

       apache-tomcat-5.5.29\webapps

  4) RHEV-M is probably already using port 8080, so change the port
     number in:

       apache-tomcat-5.5.29\conf\server.xml

  5) Run Tomcat:

       apache-tomcat-5.5.29\bin\startup.bat


== Building from Git ==

If you have checked out this directory from git and you want to build
it on Fedora, first install openjdk and make sure it's configured as
the default java version:

 $> yum install -y java-1.6.0-openjdk-devel
 $> alternatives --display javac

Then install maven and use build the code:

 $> yum install -y maven
 $> mvn install

You can then run the mock implementation using jetty:

 $> cd mock/webapp
 $> mvn jetty:run

And test it using the python tests:

 $> ./python/test.py --port=8099


== Using the Command Line Interface ==

The RHEVM-API project provides a simple CLI with command-completion
based on the Apache Felix Gogo shell. Using the CLI currently requires
an external installation of Apache ServiceMix for convenience, but
ultimately we intend to provide a more minimal option based on the
Karaf shell plus a JAX-RS provider implementation.

To install ServiceMix:

 $> wget https://repository.apache.org/content/repositories/releases/org/apache/servicemix/apache-servicemix/4.2.0/apache-servicemix-4.2.0.tar.gz
$> tar -xvzf apache-servicemix-4.2.0.tar.gz
$> cd apache-servicemix-4.2.0

Then simply launch ServiceMix:

$> bin/servicemix

The very first time you run it, allow ServiceMix a few seconds to
activate all the system bundles, then run the following commands to
install the CXF JAX-RS provider and the RHEVM-API components:

karaf@root> features:addUrl mvn:com.redhat.rhevm.api/rhevm-api-cli/0.1-SNAPSHOT/xml/features

karaf@root> features:install rhevm-api-cli

Then the vms commands will become available via tab-completion, so for
example v<TAB>l<TAB> will resolve to "vms:list", whereas v<TAB>sh<TAB>
vm<TAB> will resolve to vms:shutdown with a list of VM names to choose
from.

The --help option is supported with each command giving basic
man-style documentation.

By default the base URL used matches the port for deployment option #2
described above, but this can be over-ridden, for example:

$> export JAVA_OPTS=-Drhevm.base.url=http://localhost:8080/rhevm-api-mock

= RHEV-M API Definition =

This is the very early stages of a project to define an official
RESTful API for RHEV-M.

See our wiki for more details:

  https://fedorahosted.org/rhevm-api/

== Disclaimers ==

The API definition is in its early stages. It may yet change radically
and/or never become the official API.

The PowerShell wrapper is for experimentation only and not a supported
Red Hat solution.

== Testing ==

There are two options for running the python tests, either install and
deploy to a full-blown JBoss instance, or else take a more lightweight
approach and deploy via the maven jetty plugin.

Option 1:
---------
You first need to install JBoss. JBoss EAP 5.0 or JBoss AS 5.1.0.GA
should work.

 $> wget https://sourceforge.net/projects/jboss/files/JBoss/JBoss-5.1.0.GA/jboss-5.1.0.GA.zip/download
 $> unzip jboss-5.1.0.GA.zip
 $> mv jboss-5.1.0.GA /usr/local/jboss-5.1.0.GA
 $> chown -R markmc:markmc /usr/local/jboss-5.1.0.GA

Install openjdk and make sure it's configured as the default java
version:

 $> yum install -y java-1.6.0-openjdk-devel
 $> alternatives --display javac

Build:

 $> mvn install

Deploy:

 $> cp dummy/webapp/target/rhevm-api-dummy.war /usr/local/jboss-5.1.0.GA/server/default/deploy/rhevm-api-dummy.war

Run:

 $> /usr/local/jboss-5.1.0.GA/bin/run.sh

Test:

 $> ./python/test.py

Option 2:
---------
No external installation is required, simply build, run and test.

Build:

 $> mvn install

Run:

 $> cd dummy/webapp ; mvn jetty:run

Test:

 $> ./python/test.py --port=8099


=== Using the Command Line Interface ===

The RHEVM-API project provides a simple CLI with command-completion
based on the Apache Felix Gogo shell. Using the CLI currently requires
an external installation of Apache ServiceMix for convenience, but
ultimately we intend to provide a more minimal option based on the
Karaf shell plus a JAX-RS provider implementation.

To install ServiceMix:

$> wget https://repository.apache.org/content/repositories/releases/org/apache/servicemix/apache-servicemix/4.2.0/apache-servicemix-4.2.0.tar.gz
$> tar -xvzf apache-servicemix-4.2.0.tar.gz
$> cd apache-servicemix-4.2.0

Then simply launch ServiceMix:

$> bin/servicemix

The very first time you run it, allow ServiceMix a few seconds to
activate all the system bundles, then run the following commands to
install the CXF JAX-RS provider and the RHEVM-API components:

karaf@root> features:addUrl mvn:com.redhat.rhevm.api/rhevm-api-cli/0.1-SNAPSHOT/xml/features

karaf@root> features:install rhevm-api-cli

Then the vms commands will become available via tab-completion, so for
example v<TAB>l<TAB> will resolve to "vms:list", whereas v<TAB>sh<TAB>
vm<TAB> will resolve to vms:shutdown with a list of VM names to choose
from.

The --help option is supported with each command giving basic
man-style documentation.

By default the base URL used matches the port for deployment option #2
described above, but this can be over-ridden, for example:

$> export JAVA_OPTS=-Drhevm.base.url=http://localhost:8080/rhevm-api-dummy
